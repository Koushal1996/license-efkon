<div class="container mt-4">
  <button class="btn btn-danger" (click)="createpProject()">Create Project</button>
</div>
<div class="text-center">
  <div *ngIf="isloader" class="spinner-border text-danger" style="width: 6rem; height: 6rem;"></div>
</div>
<div class="table-responsive">

  <table class="table table-bordered mt-4">
    <thead>
      <tr>
        <th scope="col">#</th>
        <th scope="col">Customer Name</th>
        <th scope="col">Customer Email</th>
        <th scope="col"> Is Email Send</th>
        <th scope="col">Customer Contact NO</th>
        <th scope="col"> Project Type</th>
        <th scope="col">Project Manager</th>
        <th scope="col">Action</th>
      </tr>
    </thead>
    <tbody id="accordion">
      <ng-container *ngFor="let project of projects ; index as i">
        <tr data-toggle="collapse" [attr.data-target]="'#collapse' + i" (click)="getProductsByProjectId(project)">
          <td>{{i+1}}</td>
          <td>{{project.customerName}}</td>
          <td>{{project.customerEmail}}</td>
          <td>{{project.isEmailSend}}</td>
          <td>{{project.customerContactNo}}</td>
          <td>{{project.projectTypeName}}</td>
          <td>{{project.projectManagerName}}</td>
          <td><button class=" btn btn-primary" (click)="addProduct(project)">Add Product</button></td>
        </tr>
        <tr>
          <td colspan="8" class="padding">
            <div [attr.id]="'collapse' + i" class="collapse" data-parent="#accordion">
              <div *ngIf="!project.products || !project.products.length">
                <p class="text-black-50 text-center"> No Products Available Now</p>
              </div>
              <table class="table table-bordered">
                <tr class="text-primary" *ngIf="project.products && project.products.length">
                  <th scope="col">#</th>
                  <th scope="col">Product Detail</th>
                  <th scope="col">No of License</th>
                  <th scope="col">License Type</th>
                  <th scope="col">Expiration Period</th>
                  <th scope="col">Expiration Month</th>
                  <th scope="col"> Start Date </th>
                  <th scope="col">End Date</th>
                  <th scope="col">Status</th>
                  <th scope="col">Action</th>
                </tr>
                <tr *ngFor="let pro of project.products ; index as i">
                  <td>{{i+1}}</td>
                  <td>
                    {{pro.productDetailResponse.productCodeName}}
                    {{pro.productDetailResponse.productFamilyName}}
                    {{pro.productDetailResponse.versionName}}
                  </td>
                  <td>{{pro.licenseCount}}</td>
                  <td>{{pro.licenseType}}</td>
                  <td>{{pro.expirationPeriodType}}</td>
                  <td>{{pro.expirationMonthCount}}</td>
                  <td>{{pro.startDate}}</td>
                  <td>{{pro.endDate}}</td>
                  <td>{{pro.status}}</td>
                  <td *ngIf="pro.status=='DRAFT'">
                    <a class="text-primary pr-2 cursor" 
                    (click)="editProduct(project,pro)">
                      <i class="fa fa-edit"></i>
                    </a>
                    <a class="text-danger pl-2 cursor" 
                    (click)="deleteProduct(pro)">
                      <i class="fa fa-trash"></i>
                    </a>
                    <button class="btn btn-danger ml-3" type="button"
                     (click)="submitProductStatus(pro)">Submit</button>
                  </td>
                  <td *ngIf="pro.status=='SUBMIT'">
                    <button class="btn btn-danger" type="button"
                    (click)="reviewProductStatus(pro)">Review</button>
                  </td>
                  <td *ngIf="pro.status=='REVIEWED'">
                    <button class="btn btn-danger" type="button"
                    (click)="approveProductStatus(pro)">Approved</button>
                  </td>
                  <td *ngIf="pro.status=='APPROVED'">
                    <button class="btn btn-danger" type="button"
                      (click)="rejectProductStatus(pro)" 
                      >Reject
                    </button>
                  </td>
                </tr>
              </table>
            </div>
          </td>
        </tr>
      </ng-container>
    </tbody>
  </table>
</div>

<div class="modal" id="myModal" [style.display]="showModal ? 'block' : 'none'">
  <div class="modal-dialog">
    <div class="modal-content">
          <div class="modal-header">
        <h4 class="modal-title">Enter Comment</h4>
        <button type="button" class="close" data-dismiss="modal"
        (click) = "hide()">&times;</button>
      </div>

      <form (ngSubmit)="onSubmitComment()" [formGroup]="popUpForm">
            <div class="modal-body">
              <div class="form-group">
             <textarea class="form-control"
             formControlName="comment" name="comment" ></textarea>
             <span *ngIf="popUpForm.get('comment').errors &&
             (popUpForm.get('comment').touched||popUpForm.get('comment').dirty)">
               <span *ngIf="popUpForm.get('comment').errors.required" class="text-danger">
             Comment is required</span>
             </span>
           </div>
          </div>
            <div class="modal-footer">
            <button type="submit" class="btn btn-danger"  [disabled]="!popUpForm.valid">
              {{commentSubmitButton}}
          </button>
           </div>
       </form>
      
    </div>
  </div>
  </div>